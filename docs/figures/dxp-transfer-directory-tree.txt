                                                                                                          TransferDirectoryTree                                                                                                 
                                                                                                                                                                                                                                
                              ┌───────────────────┐          ┌───────────────┐                              ┌─────────┐                                ┌────────────┐                                                           
                              │fs:SenderFilesystem│          │bf:SenderBuffer│                              │ps:Sender│                                │ps:Recipient│                                                           
                              └─────────┬─────────┘          └───────┬───────┘                              └────┬────┘                                └─────┬──────┘                                                           
                                        │                            │                                          ┌┴┐                                          │                                                                  
                                        │                            │                  ╔══════╤════════════════╪═╪══════════════════════════════════════════╪═════════════════════════╗                                        
                                        │                            │                  ║ OPT  │  Recipient requests to receive a directory tree             │                         ║                                        
                                        │                            │                  ╟──────┘                │ │                                          │                         ║                                        
                                        │                            │                  ║                       │ │              𝟏 PULL <PATH>               │                         ║                                        
                                        │                            │                  ║                       │ │              ...                         │                         ║                                        
                                        │                            │                  ║                       │ │ <────────────────────────────────────────│                         ║                                        
                                        │                            │                  ║                       │ │                                          │                         ║                                        
                                        │                            │                  ║                       │ │                                          │                         ║                                        
                                        │                            │                  ║         ╔════════╤════╪═╪══════════════════════════════════════════╪═══════════════╗         ║                                        
                                        │                            │                  ║         ║ BREAK  │  Sender refuses to send the directory tree      │               ║         ║                                        
                                        │                            │                  ║         ╟────────┘    │ │                                          │               ║         ║                                        
                                        │                            │                  ║         ║             │ │             𝟐 1001 DECLINED              │               ║         ║                                        
                                        │                            │                  ║         ║             │ │             ...                          │               ║         ║                                        
                                        │                            │                  ║         ║             │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>│               ║         ║                                        
                                        │                            │                  ║         ╚═════════════╪═╪══════════════════════════════════════════╪═══════════════╝         ║                                        
                                        │                            │                  ╚═══════════════════════╪═╪══════════════════════════════════════════╪═════════════════════════╝                                        
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │────┐                                     │                                                                  
                                        │                            │                                          │ │    │ 𝟑 Generate cookie                   │                                                                  
                                        │                            │                                          │ │<───┘                                     │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                           ┌┴┐           𝟒 Put cookie record           │ │                                          │                                                                  
                                        │                           │ │ <───────────────────────────────────────│ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           └┬┘                                         │ │                                          │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │    𝟓 PUSH <DIR_NAME>                    ┌┴┐                                                                 
                                        │                            │                                          │ │    Cookie: <COOKIE>                     │ │                                                                 
                                        │                            │                                          │ │    Cookie-Expire: <EXPIRE_DATETIME>     │ │                                                                 
                                        │                            │                                          │ │    ...                                  │ │                                                                 
                                        │                            │                                          │ │ ───────────────────────────────────────>│ │                                                                 
                                        │                            │                                          │ │                                         │ │                                                                 
                                        │                            │                                          │ │                                         │ │────┐                                                            
                                        │                            │                                          │ │                                         │ │    │ 𝟔 Remember cookie                                          
                                        │                            │                                          │ │                                         │ │<───┘                                                            
                                        │                            │                                          │ │                                         │ │                                                                 
                                        │                            │                                          │ │                                         │ │                                                                 
          ╔══════╤══════════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╗
          ║ ALT  │  Recipient accepts to receive the directory tree  │                                          │ │                                         │ │                                                                ║
          ╟──────┘                      │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │            𝟕 1000 ACCEPTED              │ │                                                                ║
          ║                             │                            │                                          │ │            Cookie: <COOKIE>             │ │                                                                ║
          ║                             │                            │                                          │ │            ...                          │ │                                                                ║
          ║                             │                            │                                          │ │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐           𝟖 Get cookie record           │ │                                         │ │                                                                ║
          ║                             │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           └┬┘                                         │ │                                         │ │                                                                ║
          ║                             │                            │             𝟗 Cookie record              │ │                                         │ │                                                                ║
          ║                             │                            │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │────┐                                    │ │                                                                ║
          ║                             │                            │                                          │ │    │ 𝟏𝟎 Check cookie expiry             │ │                                                                ║
          ║                             │                            │                                          │ │<───┘                                    │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                  ╔════════╤══════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╗                                       ║
          ║                             │                            │                  ║ BREAK  │  Faulty cookie │                                         │ │                        ║                                       ║
          ║                             │                            │                  ╟────────┘              │ │                                         │ │                        ║                                       ║
          ║                             │                            │                  ║                       │ │                                         │ │                        ║                                       ║
          ║                             │                            │                  ║         ╔══════╤══════╪═╪═════════════════════════════════════════╪═╪══════════════╗         ║                                       ║
          ║                             │                            │                  ║         ║ ALT  │  Cookie has expired                              │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ╟──────┘      │ │                                         │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │         𝟏𝟏 1002 COOKIE EXPIRED          │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │         ...                             │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                                       ║
          ║                             │                            │                  ║         ╠═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╣         ║                                       ║
          ║                             │                            │                  ║         ║ [Cookie does not exist]                                 │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │              𝟏𝟐 74 EBADMSG              │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │              ...                        │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                                       ║
          ║                             │                            │                  ║         ╚═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╝         ║                                       ║
          ║                             │                            │                  ╚═══════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╝                                       ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐     𝟏𝟑 Mark cookie record as valid      │ │                                         │ │                                                                ║
          ║                             │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           └┬┘                                         │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │            𝟏𝟒 POLL                      │ │                                                                ║
          ║                             │                            │                                          │ │            Cookie: <COOKIE>             │ │                                                                ║
          ║                             │                            │                                          │ │            ...                          │ │                                                                ║
          ║                             │                            │                                          │ │ ───────────────────────────────────────>│ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║         ╔═══════╤═══════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪══════════════════════════════════════════════════════╗         ║
          ║         ║ LOOP  │           │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ╟───────┘           │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            𝟏𝟓 PICK <COOKIE>             │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            Cookie: <COOKIE>             │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            ...                          │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │ <───────────────────────────────────────│ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           ┌┴┐          𝟏𝟔 Get cookie record           │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           └┬┘                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │            𝟏𝟕 Cookie record              │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │    │ 𝟏𝟖 Check cookie expiry and validity│ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │╔════════╤══════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═════════════════════════╗                            ║         ║
          ║         ║                   │║ BREAK  │  Faulty cookie   │                                          │ │                                         │ │                         ║                            ║         ║
          ║         ║                   │╟────────┘                  │                                          │ │                                         │ │                         ║                            ║         ║
          ║         ║                   │║                           │                                          │ │                                         │ │                         ║                            ║         ║
          ║         ║                   │║         ╔══════╤══════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╗         ║                            ║         ║
          ║         ║                   │║         ║ ALT  │  Cookie has expired                                 │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ╟──────┘          │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │         𝟏𝟗 1002 COOKIE EXPIRED          │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │         ...                             │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │               ║         ║                            ║         ║
          ║         ║                   │║         ╠═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╣         ║                            ║         ║
          ║         ║                   │║         ║ [Cookie is invalid]                                        │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                ┌┴┐     𝟐𝟎 Expire out the cookie record     │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │ <───────────────────────────────────────│ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                └┬┘                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              𝟐𝟏 74 EBADMSG              │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              ...                        │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │               ║         ║                            ║         ║
          ║         ║                   │║         ╠═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╣         ║                            ║         ║
          ║         ║                   │║         ║ [Cookie does not exist]                                    │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              𝟐𝟐 74 EBADMSG              │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              ...                        │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │               ║         ║                            ║         ║
          ║         ║                   │║         ╚═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╝         ║                            ║         ║
          ║         ║                   │╚═══════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═════════════════════════╝                            ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                  ┌┴┐            𝟐𝟑 Get node contents at path in cookie record             │ │                                         │ │                                                      ║         ║
          ║         ║                  │ │ <────────────────────────────────────────────────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                  └┬┘                           │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           𝟐𝟒 Node contents                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>│ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │    │ 𝟐𝟓 Determine next path             │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │    │ 𝟐𝟔 Calculate Eng checksum          │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │          ╔════════╤════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════╗         ║         ║
          ║         ║                   │          ║ BREAK  │  No nodes left                                    │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ╟────────┘        │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                ┌┴┐     𝟐𝟕 Expire out the cookie record     │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │ <───────────────────────────────────────│ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                └┬┘                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │          𝟐𝟖 2000 DONE                   │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │          Cookie: <COOKIE>               │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │          Digest: <ENG_DIGEST>           │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │          ...                            │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │    │ 𝟐𝟗 Forget cookie                      ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │    │ 𝟑𝟎 Calculate Chang checksum           ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │    │ 𝟑𝟏 Compare Eng with Chang checksum    ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ╚═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════╝         ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           ┌┴┐𝟑𝟐 Update cookie record's next path field│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           └┬┘                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            𝟑𝟑 2001 MORE                 │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            Cookie: <COOKIE>             │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            ...                          │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │────┐                                                 ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │    │ 𝟑𝟒 Calculate Chang checksum                     ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │<───┘                                                 ║         ║
          ║         ╚═══════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪══════════════════════════════════════════════════════╝         ║
          ╠═════════════════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╣
          ║ [Recipient refuses to receive the directory tree]        │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │            𝟑𝟓 1001 DECLINED             │ │                                                                ║
          ║                             │                            │                                          │ │            Cookie: <COOKIE>             │ │                                                                ║
          ║                             │                            │                                          │ │            ...                          │ │                                                                ║
          ║                             │                            │                                          │ │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐     𝟑𝟔 Expire out the cookie record     │ │                                         │ │                                                                ║
          ║                             │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           └┬┘                                         │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ╚═════════════════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╝
                              ┌─────────┴─────────┐          ┌───────┴───────┐                              ┌───└┬┘───┐                                ┌────└┬┘─────┐                                                           
                              │fs:SenderFilesystem│          │bf:SenderBuffer│                              │ps:Sender│                                │ps:Recipient│                                                           
                              └───────────────────┘          └───────────────┘                              └─────────┘                                └────────────┘                                                           
