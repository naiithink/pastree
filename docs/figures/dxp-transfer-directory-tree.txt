                                                                                                          TransferDirectoryTree                                                                                                 
                                                                                                                                                                                                                                
                              ┌───────────────────┐          ┌───────────────┐                              ┌─────────┐                                ┌────────────┐                                                           
                              │fs:SenderFilesystem│          │bf:SenderBuffer│                              │ps:Sender│                                │ps:Recipient│                                                           
                              └─────────┬─────────┘          └───────┬───────┘                              └────┬────┘                                └─────┬──────┘                                                           
                                        │                            │                                          ┌┴┐                                          │                                                                  
                                        │                            │                            ╔══════╤══════╪═╪══════════════════════════════════════════╪═══════════════╗                                                  
                                        │                            │                            ║ OPT  │  Recipient requests to receive a directory tree   │               ║                                                  
                                        │                            │                            ╟──────┘      │ │                                          │               ║                                                  
                                        │                            │                            ║             │ │              𝟏 PULL <PATH>               │               ║                                                  
                                        │                            │                            ║             │ │              ...                         │               ║                                                  
                                        │                            │                            ║             │ │ <────────────────────────────────────────│               ║                                                  
                                        │                            │                            ╚═════════════╪═╪══════════════════════════════════════════╪═══════════════╝                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │────┐                                     │                                                                  
                                        │                            │                                          │ │    │ 𝟐 Generate cookie                   │                                                                  
                                        │                            │                                          │ │<───┘                                     │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                           ┌┴┐           𝟑 Put cookie record           │ │                                          │                                                                  
                                        │                           │ │ <───────────────────────────────────────│ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           │ │                                         │ │                                          │                                                                  
                                        │                           └┬┘                                         │ │                                          │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │                                          │                                                                  
                                        │                            │                                          │ │    𝟒 PUSH <DIR_NAME>                    ┌┴┐                                                                 
                                        │                            │                                          │ │    Cookie: <COOKIE>                     │ │                                                                 
                                        │                            │                                          │ │    Cookie-Expire: <EXPIRE_DATETIME>     │ │                                                                 
                                        │                            │                                          │ │    ...                                  │ │                                                                 
                                        │                            │                                          │ │ ───────────────────────────────────────>│ │                                                                 
                                        │                            │                                          │ │                                         │ │                                                                 
                                        │                            │                                          │ │                                         │ │────┐                                                            
                                        │                            │                                          │ │                                         │ │    │ 𝟓 Remember cookie                                          
                                        │                            │                                          │ │                                         │ │<───┘                                                            
                                        │                            │                                          │ │                                         │ │                                                                 
                                        │                            │                                          │ │                                         │ │                                                                 
          ╔══════╤══════════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╗
          ║ ALT  │  Recipient accepts to receive                     │                                          │ │                                         │ │                                                                ║
          ╟──────┘                      │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │            𝟔 1000 ACCEPTED              │ │                                                                ║
          ║                             │                            │                                          │ │            Cookie: <COOKIE>             │ │                                                                ║
          ║                             │                            │                                          │ │            ...                          │ │                                                                ║
          ║                             │                            │                                          │ │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐           𝟕 Get cookie record           │ │                                         │ │                                                                ║
          ║                             │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           └┬┘                                         │ │                                         │ │                                                                ║
          ║                             │                            │             𝟖 Cookie record              │ │                                         │ │                                                                ║
          ║                             │                            │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │────┐                                    │ │                                                                ║
          ║                             │                            │                                          │ │    │ 𝟗 Check cookie expiry              │ │                                                                ║
          ║                             │                            │                                          │ │<───┘                                    │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                  ╔════════╤══════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╗                                       ║
          ║                             │                            │                  ║ BREAK  │  Faulty cookie │                                         │ │                        ║                                       ║
          ║                             │                            │                  ╟────────┘              │ │                                         │ │                        ║                                       ║
          ║                             │                            │                  ║                       │ │                                         │ │                        ║                                       ║
          ║                             │                            │                  ║         ╔══════╤══════╪═╪═════════════════════════════════════════╪═╪══════════════╗         ║                                       ║
          ║                             │                            │                  ║         ║ ALT  │  Cookie has expired                              │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ╟──────┘      │ │                                         │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │         𝟏𝟎 1002 COOKIE EXPIRED          │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │         ...                             │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                                       ║
          ║                             │                            │                  ║         ╠═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╣         ║                                       ║
          ║                             │                            │                  ║         ║ [Cookie does not exist]                                 │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │              𝟏𝟏 74 EBADMSG              │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │              ...                        │ │              ║         ║                                       ║
          ║                             │                            │                  ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                                       ║
          ║                             │                            │                  ║         ╚═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╝         ║                                       ║
          ║                             │                            │                  ╚═══════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╝                                       ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐     𝟏𝟐 Mark cookie record as valid      │ │                                         │ │                                                                ║
          ║                             │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           └┬┘                                         │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │    𝟏𝟑 POLL                              │ │                                                                ║
          ║                             │                            │                                          │ │    Cookie: <COOKIE>                     │ │                                                                ║
          ║                             │                            │                                          │ │    Cookie-Expire: <EXPIRE_DATETIME>     │ │                                                                ║
          ║                             │                            │                                          │ │    ...                                  │ │                                                                ║
          ║                             │                            │                                          │ │ ───────────────────────────────────────>│ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║         ╔═══════╤═══════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪══════════════════════════════════════════════════════╗         ║
          ║         ║ LOOP  │           │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ╟───────┘           │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            𝟏𝟒 PICK <COOKIE>             │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            Cookie: <COOKIE>             │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │            ...                          │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │ <───────────────────────────────────────│ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           ┌┴┐          𝟏𝟓 Get cookie record           │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           └┬┘                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │            𝟏𝟔 Cookie record              │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │    │ 𝟏𝟕 Check cookie expiry and validity│ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │╔════════╤══════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═════════════════════════╗                            ║         ║
          ║         ║                   │║ BREAK  │  Faulty cookie   │                                          │ │                                         │ │                         ║                            ║         ║
          ║         ║                   │╟────────┘                  │                                          │ │                                         │ │                         ║                            ║         ║
          ║         ║                   │║                           │                                          │ │                                         │ │                         ║                            ║         ║
          ║         ║                   │║         ╔══════╤══════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╗         ║                            ║         ║
          ║         ║                   │║         ║ ALT  │  Cookie has expired                                 │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ╟──────┘          │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │         𝟏𝟖 1002 COOKIE EXPIRED          │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │         ...                             │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │ ───────────────────────────────────────>│ │               ║         ║                            ║         ║
          ║         ║                   │║         ╠═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╣         ║                            ║         ║
          ║         ║                   │║         ║ [Cookie is invalid]                                        │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                ┌┴┐     𝟏𝟗 Expire out the cookie record     │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │ <───────────────────────────────────────│ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                │ │                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                └┬┘                                         │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              𝟐𝟎 74 EBADMSG              │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              ...                        │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │ ───────────────────────────────────────>│ │               ║         ║                            ║         ║
          ║         ║                   │║         ╠═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╣         ║                            ║         ║
          ║         ║                   │║         ║ [Cookie does not exist]                                    │ │                                         │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              𝟐𝟏 74 EBADMSG              │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │              ...                        │ │               ║         ║                            ║         ║
          ║         ║                   │║         ║                 │                                          │ │ ───────────────────────────────────────>│ │               ║         ║                            ║         ║
          ║         ║                   │║         ╚═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═══════════════╝         ║                            ║         ║
          ║         ║                   │╚═══════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪═════════════════════════╝                            ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                  ┌┴┐            𝟐𝟐 Get node contents at path in cookie record             │ │                                         │ │                                                      ║         ║
          ║         ║                  │ │ <────────────────────────────────────────────────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                  └┬┘                           │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           𝟐𝟑 Node contents                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>│ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │    │ 𝟐𝟒 Determine next path             │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │    │ 𝟐𝟓 Calculate Eng checksum          │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │          ╔════════╤════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════╗         ║         ║
          ║         ║                   │          ║ BREAK  │  No nodes left                                    │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ╟────────┘        │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                ┌┴┐     𝟐𝟔 Expire out the cookie record     │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │ <───────────────────────────────────────│ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                └┬┘                                         │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │          𝟐𝟕 2000 DONE                   │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │          Digest: <ENG_DIGEST>           │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │          ...                            │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │    │ 𝟐𝟖 Forget cookie                      ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │    │ 𝟐𝟗 Calculate Chang checksum           ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │    │ 𝟑𝟎 Compare Eng with Chang checksum    ║         ║         ║
          ║         ║                   │          ║                 │                                          │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ╚═════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════╝         ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           ┌┴┐𝟑𝟏 Update cookie record's next path field│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           └┬┘                                         │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │              𝟑𝟐 2001 MORE               │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │              ...                        │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │────┐                                                 ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │    │ 𝟑𝟑 Calculate Chang checksum                     ║         ║
          ║         ║                   │                            │                                          │ │                                         │ │<───┘                                                 ║         ║
          ║         ╚═══════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪══════════════════════════════════════════════════════╝         ║
          ╠═════════════════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╣
          ║ [Recipient refuses to receive]                           │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │            𝟑𝟒 1001 DECLINED             │ │                                                                ║
          ║                             │                            │                                          │ │            ...                          │ │                                                                ║
          ║                             │                            │                                          │ │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐     𝟑𝟓 Expire out the cookie record     │ │                                         │ │                                                                ║
          ║                             │                           │ │ <───────────────────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           │ │                                         │ │                                         │ │                                                                ║
          ║                             │                           └┬┘                                         │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ║                             │                            │                                          │ │                                         │ │                                                                ║
          ╚═════════════════════════════╪════════════════════════════╪══════════════════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╝
                              ┌─────────┴─────────┐          ┌───────┴───────┐                              ┌───└┬┘───┐                                ┌────└┬┘─────┐                                                           
                              │fs:SenderFilesystem│          │bf:SenderBuffer│                              │ps:Sender│                                │ps:Recipient│                                                           
                              └───────────────────┘          └───────────────┘                              └─────────┘                                └────────────┘                                                           
