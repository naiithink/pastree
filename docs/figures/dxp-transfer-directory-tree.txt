                                                                                                    TransferDirectoryTree                                                                                          
                                                                                                                                                                                                                   
                              ┌───────────────────┐          ┌───────────────┐                 ┌─────────┐                                ┌────────────┐                                                           
                              │fs:SenderFilesystem│          │bf:SenderBuffer│                 │ps:Sender│                                │ps:Recipient│                                                           
                              └─────────┬─────────┘          └───────┬───────┘                 └────┬────┘                                └─────┬──────┘                                                           
                                        │                            │                             ┌┴┐                                          │                                                                  
                                        │                            │               ╔══════╤══════╪═╪══════════════════════════════════════════╪═══════════════╗                                                  
                                        │                            │               ║ OPT  │  Recipient requests to receive a directory tree   │               ║                                                  
                                        │                            │               ╟──────┘      │ │                                          │               ║                                                  
                                        │                            │               ║             │ │              𝟏 PULL <PATH>               │               ║                                                  
                                        │                            │               ║             │ │              ...                         │               ║                                                  
                                        │                            │               ║             │ │ <────────────────────────────────────────│               ║                                                  
                                        │                            │               ╚═════════════╪═╪══════════════════════════════════════════╪═══════════════╝                                                  
                                        │                            │                             │ │                                          │                                                                  
                                        │                            │                             │ │────┐                                     │                                                                  
                                        │                            │                             │ │    │ 𝟐 Generate cookie                   │                                                                  
                                        │                            │                             │ │<───┘                                     │                                                                  
                                        │                            │                             │ │                                          │                                                                  
                                        │                           ┌┴┐  𝟑 Save generated cookie   │ │                                          │                                                                  
                                        │                           │ │ <──────────────────────────│ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           │ │                            │ │                                          │                                                                  
                                        │                           └┬┘                            │ │                                          │                                                                  
                                        │                            │                             │ │                                          │                                                                  
                                        │                            │                             │ │                                          │                                                                  
                                        │                            │                             │ │                                          │                                                                  
                                        │                            │                             │ │    𝟒 PUSH <DIR_NAME>                    ┌┴┐                                                                 
                                        │                            │                             │ │    Cookie: <COOKIE>                     │ │                                                                 
                                        │                            │                             │ │    Cookie-Expire: <EXPIRE_DATETIME>     │ │                                                                 
                                        │                            │                             │ │    ...                                  │ │                                                                 
                                        │                            │                             │ │ ───────────────────────────────────────>│ │                                                                 
                                        │                            │                             │ │                                         │ │                                                                 
                                        │                            │                             │ │                                         │ │────┐                                                            
                                        │                            │                             │ │                                         │ │    │ 𝟓 Remember cookie                                          
                                        │                            │                             │ │                                         │ │<───┘                                                            
                                        │                            │                             │ │                                         │ │                                                                 
                                        │                            │                             │ │                                         │ │                                                                 
          ╔══════╤══════════════════════╪════════════════════════════╪═════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╗
          ║ ALT  │  Recipient accepts to receive                     │                             │ │                                         │ │                                                                ║
          ╟──────┘                      │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │            𝟔 1000 ACCEPTED              │ │                                                                ║
          ║                             │                            │                             │ │            Cookie: <COOKIE>             │ │                                                                ║
          ║                             │                            │                             │ │            ...                          │ │                                                                ║
          ║                             │                            │                             │ │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐     𝟕 Get cookie state     │ │                                         │ │                                                                ║
          ║                             │                           │ │ <──────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           └┬┘                            │ │                                         │ │                                                                ║
          ║                             │                            │       𝟖 Cookie state        │ │                                         │ │                                                                ║
          ║                             │                            │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>│ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │────┐                                    │ │                                                                ║
          ║                             │                            │                             │ │    │ 𝟗 Check cookie expiry              │ │                                                                ║
          ║                             │                            │                             │ │<───┘                                    │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │     ╔════════╤══════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╗                                       ║
          ║                             │                            │     ║ BREAK  │  Faulty cookie │                                         │ │                        ║                                       ║
          ║                             │                            │     ╟────────┘              │ │                                         │ │                        ║                                       ║
          ║                             │                            │     ║                       │ │                                         │ │                        ║                                       ║
          ║                             │                            │     ║         ╔══════╤══════╪═╪═════════════════════════════════════════╪═╪══════════════╗         ║                                       ║
          ║                             │                            │     ║         ║ ALT  │  Cookie has expired                              │ │              ║         ║                                       ║
          ║                             │                            │     ║         ╟──────┘      │ │                                         │ │              ║         ║                                       ║
          ║                             │                            │     ║         ║             │ │         𝟏𝟎 1002 COOKIE EXPIRED          │ │              ║         ║                                       ║
          ║                             │                            │     ║         ║             │ │         ...                             │ │              ║         ║                                       ║
          ║                             │                            │     ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                                       ║
          ║                             │                            │     ║         ╠═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╣         ║                                       ║
          ║                             │                            │     ║         ║ [Cookie does not exist]                                 │ │              ║         ║                                       ║
          ║                             │                            │     ║         ║             │ │              𝟏𝟏 74 EBADMSG              │ │              ║         ║                                       ║
          ║                             │                            │     ║         ║             │ │              ...                        │ │              ║         ║                                       ║
          ║                             │                            │     ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                                       ║
          ║                             │                            │     ║         ╚═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╝         ║                                       ║
          ║                             │                            │     ╚═══════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╝                                       ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐  𝟏𝟐 Mark cookie as valid   │ │                                         │ │                                                                ║
          ║                             │                           │ │ <──────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           └┬┘                            │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │    𝟏𝟑 POLL                              │ │                                                                ║
          ║                             │                            │                             │ │    Cookie: <COOKIE>                     │ │                                                                ║
          ║                             │                            │                             │ │    Cookie-Expire: <EXPIRE_DATETIME>     │ │                                                                ║
          ║                             │                            │                             │ │    ...                                  │ │                                                                ║
          ║                             │                            │                             │ │ ───────────────────────────────────────>│ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║         ╔═══════╤═══════════╪════════════════════════════╪═════════════════════════════╪═╪═════════════════════════════════════════╪═╪══════════════════════════════════════════════════════╗         ║
          ║         ║ LOOP  │           │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ╟───────┘           │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │            𝟏𝟒 PICK <COOKIE>             │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │            Cookie: <COOKIE>             │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │            ...                          │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │ <───────────────────────────────────────│ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           ┌┴┐    𝟏𝟓 Get cookie state     │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │ <──────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           └┬┘                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │      𝟏𝟔 Cookie state        │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─>│ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │    │ 𝟏𝟕 Check cookie expiry and validity│ │                                                      ║         ║
          ║         ║                   │                            │                             │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │     ╔════════╤══════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╗                             ║         ║
          ║         ║                   │                            │     ║ BREAK  │  Faulty cookie │                                         │ │                        ║                             ║         ║
          ║         ║                   │                            │     ╟────────┘              │ │                                         │ │                        ║                             ║         ║
          ║         ║                   │                            │     ║                       │ │                                         │ │                        ║                             ║         ║
          ║         ║                   │                            │     ║         ╔══════╤══════╪═╪═════════════════════════════════════════╪═╪══════════════╗         ║                             ║         ║
          ║         ║                   │                            │     ║         ║ ALT  │  Cookie has expired                              │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ╟──────┘      │ │                                         │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │         𝟏𝟖 1002 COOKIE EXPIRED          │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │         ...                             │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ╠═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╣         ║                             ║         ║
          ║         ║                   │                            │     ║         ║ [Cookie is invalid]                                     │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │         𝟏𝟗 1003 INVALID COOKIE          │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │         ...                             │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ╠═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╣         ║                             ║         ║
          ║         ║                   │                            │     ║         ║ [Cookie does not exist]                                 │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │              𝟐𝟎 74 EBADMSG              │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │              ...                        │ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ║             │ │ ───────────────────────────────────────>│ │              ║         ║                             ║         ║
          ║         ║                   │                            │     ║         ╚═════════════╪═╪═════════════════════════════════════════╪═╪══════════════╝         ║                             ║         ║
          ║         ║                   │                            │     ╚═══════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════╝                             ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                  ┌┴┐      𝟐𝟏 Get node contents at path in cookie state       │ │                                         │ │                                                      ║         ║
          ║         ║                  │ │ <───────────────────────────────────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                  └┬┘                           │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                    𝟐𝟐 Node contents                      │ │                                         │ │                                                      ║         ║
          ║         ║                   │ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │    │ 𝟐𝟑 Determine forthcoming path      │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │────┐                                    │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │    │ 𝟐𝟒 Calculate Eng checksum          │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │<───┘                                    │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │          ╔════════╤════════╪═════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════╗         ║         ║
          ║         ║                   │          ║ BREAK  │  No nodes left                       │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ╟────────┘        │                             │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                ┌┴┐  𝟐𝟓 Expire out the cookie  │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │ <──────────────────────────│ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                │ │                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                └┬┘                            │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │          𝟐𝟔 2000 DONE                   │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │          Digest: <ENG_DIGEST>           │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │          ...                            │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │    │ 𝟐𝟕 Forget cookie                      ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │    │ 𝟐𝟖 Calculate Chang checksum           ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │                                            ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │────┐                                       ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │    │ 𝟐𝟗 Compare Eng with Chang checksum    ║         ║         ║
          ║         ║                   │          ║                 │                             │ │                                         │ │<───┘                                       ║         ║         ║
          ║         ║                   │          ╚═════════════════╪═════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════╝         ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           ┌┴┐𝟑𝟎 Update cookie's next path│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │ <──────────────────────────│ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           │ │                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                           └┬┘                            │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │              𝟑𝟏 2001 MORE               │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │              ...                        │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │  ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ >│ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │                                                      ║         ║
          ║         ║                   │                            │                             │ │                                         │ │────┐                                                 ║         ║
          ║         ║                   │                            │                             │ │                                         │ │    │ 𝟑𝟐 Calculate Chang checksum                     ║         ║
          ║         ║                   │                            │                             │ │                                         │ │<───┘                                                 ║         ║
          ║         ╚═══════════════════╪════════════════════════════╪═════════════════════════════╪═╪═════════════════════════════════════════╪═╪══════════════════════════════════════════════════════╝         ║
          ╠═════════════════════════════╪════════════════════════════╪═════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╣
          ║ [Recipient refuses to receive]                           │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │            𝟑𝟑 1001 DECLINED             │ │                                                                ║
          ║                             │                            │                             │ │            ...                          │ │                                                                ║
          ║                             │                            │                             │ │ <─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─│ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                           ┌┴┐  𝟑𝟒 Expire out the cookie  │ │                                         │ │                                                                ║
          ║                             │                           │ │ <──────────────────────────│ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           │ │                            │ │                                         │ │                                                                ║
          ║                             │                           └┬┘                            │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ║                             │                            │                             │ │                                         │ │                                                                ║
          ╚═════════════════════════════╪════════════════════════════╪═════════════════════════════╪═╪═════════════════════════════════════════╪═╪════════════════════════════════════════════════════════════════╝
                              ┌─────────┴─────────┐          ┌───────┴───────┐                 ┌───└┬┘───┐                                ┌────└┬┘─────┐                                                           
                              │fs:SenderFilesystem│          │bf:SenderBuffer│                 │ps:Sender│                                │ps:Recipient│                                                           
                              └───────────────────┘          └───────────────┘                 └─────────┘                                └────────────┘                                                           
